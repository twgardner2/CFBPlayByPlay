<!DOCTYPE html>

<html>

	<head>
	
		<title>VT Hokies Game Stats Visualization</title>
		<meta charset="utf-8" />
		
		<!-- CSS -->
		<style>


		</style> 

	</head>

	<!-- Add d3 library -->
	<script src="d3.js" type="text/javascript"></script>
	<script src="lodash.js" type="text/javascript"></script>
	<!-- Build page structure -->
	<body>
		<div id="viz">
			<div id="checkboxes"></div><br>
			<svg width="1000" height="500" style="border:1px lightgray solid;" />
		</div>
	</body>
	
	
	<script> 

	d3.json("VT-duke.json", viz);
	
	function viz(data) {
		
		console.log("All Data:");
		console.log(data);
		
		var plays = getPlaysFromJSON(data);
		console.log("All Plays:");
		console.log(plays);
		
		var uniquePlayIds = getUniquePlayIds(plays);
		console.log("Unique: ")
		console.log(uniquePlayIds);
		
		plays = addPasserRusherRecieverToPlays(plays);
		console.log("All Plays (w/ passer, rusher, reciever):");
		console.log(plays);
		
		plays = getPlaysRushing(plays);
		console.log("All Rushing Plays:");
		console.log(plays);
		
	};
	
	function getUniquePlayIds(plays) {

		let unique = [];
		
		// Loop through plays, populate array of unique ids
		Object.keys(plays).forEach( function(play) {
			let thisID = plays[play].type.id;
			let trigger = 0;
			
			for (i = 0; i < unique.length; i++ ) {
				if (unique[i].id === thisID) { trigger++}
			}
			if (trigger == 0) { unique.push( {id: plays[play].type.id,
											  text: plays[play].type.text,
											  abbreviation: plays[play].type.abbreviation,
										  }) };
		});
		return unique;
	};
	
	function getPlaysRushing(plays) {
		playsRushing = _.cloneDeep(plays);
		for (play in playsRushing) {
			if (playsRushing[play].type.id != 5 && 
				playsRushing[play].type.id != 7 &&
				playsRushing[play].type.id != 68) { 
				delete playsRushing[play];
			};
		};
		return playsRushing;
	};
	
	function calcRushingTotals(plays) {
		
		
		
	};
	
	function getPlaysFromJSON(gameDataJSON) {
		
		let drives = gameDataJSON.drives.previous;
		let plays = {};
		let i = 0;

		drives.forEach(function(drive) {
			drive.plays.forEach(function(play) {
				plays[i] = play;
				i++;
			});
		});
		return plays;
	};
	
	// NOT COMPLETE
	function addPasserRusherRecieverToPlays(plays) {
	
		Object.keys(plays).forEach(function(play) {
			plays[play]["passer"] = null;
			plays[play]["rusher"] = null;
			plays[play]["receiver"] = null;
			
			
			

		});
		return(plays);
	};
	
	</script>
	
</html>